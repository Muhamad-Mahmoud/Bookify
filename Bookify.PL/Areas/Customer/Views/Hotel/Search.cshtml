@model Bookify.Models.ViewModels.HotelSearchVM

@{
    ViewData["Title"] = "Search Results";
    ViewData["Location"] = Model.Location;
    ViewData["CheckInDate"] = Model.CheckInDate;
    ViewData["CheckOutDate"] = Model.CheckOutDate;
    ViewData["GuestCount"] = Model.GuestCount;
}

@section Styles {
    <link rel="stylesheet" href="~/css/hotel-search.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/home-sections.css" asp-append-version="true" />
}

@section Scripts {
    <script src="~/javascript/main.js" asp-append-version="true"></script>
    <script>
        // Ensure hidden inputs are updated before submit
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('searchForm');
            if (form) {
                form.addEventListener('submit', function() {
                    if (window.combinedCalendar) {
                        window.combinedCalendar.updateInputs();
                    }
                });
            }
        });
    </script>
}

<div class="search-page-container">
    <!-- Full Search Box -->
    <div class="mb-5">
        <partial name="_SearchBoxPartial" />
    </div>

    <div class="container">
        <div class="row">
            <!-- Sidebar Filters (Optional placeholder for now) -->
            <div class="col-lg-3 d-none d-lg-block">
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Filter by</h5>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Star Rating</label>
                            <div class="d-flex flex-column gap-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="star5">
                                    <label class="form-check-label" for="star5">5 Stars</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="star4">
                                    <label class="form-check-label" for="star4">4 Stars</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>

            <!-- Results List -->
            <div class="col-lg-9">
                <!-- Top Filter Bar -->
                <div class="filter-bar">
                    <button class="filter-btn active">Recommended</button>
                    <button class="filter-btn">Price <i class="fas fa-chevron-down" style="font-size: 0.7rem;"></i></button>
                    <button class="filter-btn">Guest Rating <i class="fas fa-chevron-down" style="font-size: 0.7rem;"></i></button>
                    <button class="filter-btn">Distance <i class="fas fa-chevron-down" style="font-size: 0.7rem;"></i></button>
                    <button class="filter-btn">Stars <i class="fas fa-chevron-down" style="font-size: 0.7rem;"></i></button>
                </div>

                @if (Model.Hotels != null && Model.Hotels.Any())
                {
                    @foreach (var hotel in Model.Hotels)
                    {
                        var minPrice = hotel.RoomTypes.Any() ? hotel.RoomTypes.Min(rt => rt.BasePrice) : 0;
                        
                        <div class="hotel-search-card">
                            <!-- Image Column -->
                            <div class="hotel-card-image">
                                <img src="@(string.IsNullOrEmpty(hotel.MainImage) ? "/images/placeholder-hotel.jpg" : hotel.MainImage)" alt="@hotel.Name">
                                <button class="card-wishlist-btn" aria-label="Add to wishlist">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>

                            <!-- Details Column -->
                            <div class="hotel-card-details">
                                <div class="hotel-card-header">
                                    <div>
                                        <a href="@Url.Action("GetHotel", "Hotel", new { id = hotel.Id, checkInDate = Model.CheckInDate.ToString("yyyy-MM-dd"), checkOutDate = Model.CheckOutDate.ToString("yyyy-MM-dd"), guestCount = Model.GuestCount })" class="hotel-name">
                                            @hotel.Name
                                        </a>
                                        <div class="hotel-stars">
                                            @for (int i = 0; i < hotel.StarRating; i++)
                                            {
                                                <i class="fas fa-star"></i>
                                            }
                                            <span class="text-muted ms-2" style="font-size: 0.8rem;">Hotel</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="hotel-location">
                                    <i class="fas fa-map-marker-alt text-primary"></i>
                                    <span>@hotel.Address, @hotel.City?.Name</span>
                                    <a href="#" class="ms-2">Show on map</a>
                                </div>

                                <div class="hotel-description-preview">
                                    @hotel.Description
                                </div>

                                <div class="hotel-features">
                                    <div class="feature-item"><i class="fas fa-check"></i> Free cancellation</div>
                                    <div class="feature-item"><i class="fas fa-check"></i> No prepayment needed</div>
                                    <div class="feature-item"><i class="fas fa-check"></i> Breakfast included</div>
                                </div>
                            </div>

                            <!-- Pricing Column -->
                            <div class="hotel-card-pricing">
                                <div class="review-badge">
                                    <div class="text-end">
                                        <div class="review-text">@(hotel.UserRating >= 9 ? "Excellent" : hotel.UserRating >= 8 ? "Very Good" : "Good")</div>
                                        <div class="review-count">@hotel.ReviewCount reviews</div>
                                    </div>
                                    <div class="review-score">@hotel.UserRating.ToString("0.0")</div>
                                </div>

                                <div class="price-section">
                                    <div class="price-label">1 night, @Model.GuestCount adults</div>
                                    <div class="price-amount">EGP @minPrice.ToString("N0")</div>
                                    <div class="price-taxes">+EGP @((minPrice * 0.14m).ToString("N0")) taxes and charges</div>
                                    
                                    <a href="@Url.Action("GetHotel", "Hotel", new { id = hotel.Id, checkInDate = Model.CheckInDate.ToString("yyyy-MM-dd"), checkOutDate = Model.CheckOutDate.ToString("yyyy-MM-dd"), guestCount = Model.GuestCount })" class="btn-view-deal">
                                        See Availability <i class="fas fa-chevron-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center py-5">
                        <div class="mb-3 text-muted">
                            <i class="fas fa-search fa-3x"></i>
                        </div>
                        <h3>No hotels found</h3>
                        <p class="text-muted">We couldn't find any properties matching your search criteria.</p>
                        <a href="/" class="btn btn-primary mt-3">Search Again</a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
